{"ast":null,"code":"import $ from 'jquery';\nimport * as edit from '../edit/edit';\nimport * as util from '../util/util';\nimport Task from '../../components/Task/Task';\nexport function checkTimes() {\n  const today = new Date();\n  const now = [today.getHours(), today.getMinutes()];\n  const dateString = today.toDateString();\n  const list = window.data.tasks[Object.keys(window.data.tasks).find(x => window.data.tasks[x].title === dateString)];\n  if (!list) return;\n  const todayList = list.subtasks;\n\n  for (let task of todayList) {\n    const taskEntry = window.data.tasks[util.stripR(task)];\n\n    if (taskEntry.info.type === 'event' && taskEntry.info.complete !== 'complete' && !taskEntry.info.startDate.includes('--')) {\n      if (taskEntry.info.startDate[0] === now[0] && taskEntry.info.startDate[1] === now[1]) {\n        var permission = Notification.requestPermission();\n        const notification = new Notification('Event: ' + taskEntry.title);\n        break;\n      } else {\n        const newDate = new Date();\n        newDate.setHours(taskEntry.info.startDate[0]);\n        newDate.setMinutes(taskEntry.info.startDate[1]);\n        newDate.setMinutes(newDate.getMinutes() - 15);\n\n        if (taskEntry.info.type === 'event' && newDate.getHours() === now[0] && newDate.getMinutes() === now[1]) {\n          var permission = Notification.requestPermission();\n          const notification = new Notification('in 15: ' + taskEntry.title);\n        }\n      }\n    }\n  }\n}\nexport function switchView(direction) {\n  if (!window.selected) return;\n  let parent = window.selected;\n\n  while (parent instanceof Task) {\n    parent = parent.props.parent;\n  }\n\n  parent.props.parent.changeIndex(direction);\n  updateAllSizes();\n}\nexport function toggleMode() {\n  if (window.data.settings.mode == 'night') {\n    window.data.settings.mode = 'day';\n  } else {\n    window.data.settings.mode = 'night';\n  }\n\n  display.setTheme(window.data.settings.theme);\n  localStorage.setItem('data', JSON.stringify(window.data));\n}\nexport function toggleSounds() {\n  if (window.data.settings.sounds == 'false') {\n    window.data.settings.sounds = 'true';\n    alert('sounds on');\n  } else {\n    window.data.settings.sounds = 'false';\n    alert('sounds off');\n  }\n}\nexport function focus(set) {\n  if (set != undefined) {\n    var focusSet = set;\n  } else {\n    if (window.app.current.state.bank.current.state.info.focused == 'focused') {\n      var focusSet = '';\n    } else {\n      var focusSet = 'focused';\n    }\n  }\n\n  if (window.selected) {\n    // set the index of the focused list to the window.selected list\n    let focusView = window.selected;\n\n    while (focusView instanceof Task) {\n      focusView = focusView.props.parent;\n    }\n\n    focusView.props.parent.changeIndex(focusView.props.parent.frames.findIndex(x => x.current.props.id == focusView.props.id));\n  }\n\n  window.app.current.state.bank.current.setState(prevState => ({\n    info: { ...prevState.info,\n      focused: focusSet\n    },\n    width: processWidth(focusSet)\n  }));\n  window.app.current.state.river.current.setState(prevState => ({\n    info: { ...prevState.info,\n      focused: focusSet\n    },\n    width: processWidth(focusSet)\n  }));\n  edit.saveSetting('focused', focusSet);\n  updateAllSizes();\n}\nexport function updateAllSizes() {\n  function update(list) {\n    if (list.current instanceof Task) {\n      list.current.updateHeight();\n    }\n\n    for (let task of list.current.taskList.current.subtaskObjects) {\n      update(task);\n    }\n  }\n\n  const riverLists = window.app.current.state.river.current.frames;\n  const bankLists = window.app.current.state.bank.current.frames;\n\n  for (let list of riverLists.concat(bankLists)) {\n    update(list);\n  }\n}\nexport function setTheme(theme) {\n  const newTheme = window.themes[theme + '-' + window.data.settings.mode];\n\n  for (let key of Object.keys(newTheme)) {\n    document.documentElement.style.setProperty(key, newTheme[key]);\n  }\n\n  window.data.settings.theme = theme;\n  localStorage.setItem('data', JSON.stringify(window.data));\n  setTimeout(updateAllSizes, 100);\n}\nexport function displayTable() {\n  if (window.app.current.state.displayTable === 'none' && window.selected) {\n    window.app.current.setState({\n      displayTable: 'true'\n    });\n  } else {\n    window.app.current.setState({\n      displayTable: 'none'\n    });\n  }\n\n  console.log(window.app.current.state.displayTable);\n}\nexport function playSound(sound) {\n  if (window.data.settings.sounds === 'true') {\n    sound.play();\n  }\n}\nexport function processWidth(focused) {\n  if (focused != 'focused') {\n    var width = Math.floor(window.innerWidth / 250);\n    $(':root').css('--frameWidth', (window.innerWidth - 40) / width + 'px');\n  } else {\n    // focus mode\n    var width = 1;\n    $(':root').css('--frameWidth', 'calc(100% - 24px)');\n  }\n\n  return width;\n}\nexport function goToToday() {\n  searchDate(new Date().toDateString());\n}\nexport function searchDate(text, type) {\n  setTimeout(() => {\n    window.app.current.statusBar.current.search({\n      target: {\n        value: text\n      }\n    });\n    window.app.current.statusBar.current.goToFirst();\n  }, 100);\n}\nexport function zoom() {\n  // zoom everything upwards\n  if (window.app.current.state.zoomed === 'zoomed') {\n    var zoomedSetting = '';\n  } else {\n    var zoomedSetting = 'zoomed';\n\n    if (!window.selected) {\n      return;\n    }\n\n    ; // no zoomie\n  }\n\n  var zoomFrame = util.getFrame(window.selected);\n  zoomFrame.setState({\n    zoomed: zoomedSetting\n  });\n  window.app.current.setState({\n    zoomed: zoomedSetting\n  });\n\n  if (!window.zoomed) {\n    // unzoom\n    window.zoomed = window.selected;\n  } else {\n    window.zoomed = undefined;\n  }\n\n  setTimeout(updateAllSizes, 200);\n}","map":{"version":3,"sources":["/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/src/services/display/display.js"],"names":["$","edit","util","Task","checkTimes","today","Date","now","getHours","getMinutes","dateString","toDateString","list","window","data","tasks","Object","keys","find","x","title","todayList","subtasks","task","taskEntry","stripR","info","type","complete","startDate","includes","permission","Notification","requestPermission","notification","newDate","setHours","setMinutes","switchView","direction","selected","parent","props","changeIndex","updateAllSizes","toggleMode","settings","mode","display","setTheme","theme","localStorage","setItem","JSON","stringify","toggleSounds","sounds","alert","focus","set","undefined","focusSet","app","current","state","bank","focused","focusView","frames","findIndex","id","setState","prevState","width","processWidth","river","saveSetting","update","updateHeight","taskList","subtaskObjects","riverLists","bankLists","concat","newTheme","themes","key","document","documentElement","style","setProperty","setTimeout","displayTable","console","log","playSound","sound","play","Math","floor","innerWidth","css","goToToday","searchDate","text","statusBar","search","target","value","goToFirst","zoom","zoomed","zoomedSetting","zoomFrame","getFrame"],"mappings":"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","sourcesContent":["import $ from 'jquery';\nimport * as edit from '../edit/edit';\nimport * as util from '../util/util';\nimport Task from '../../components/Task/Task';\n\nexport function checkTimes() {\n  const today = new Date();\n  const now = [today.getHours(), today.getMinutes()];\n  const dateString = today.toDateString();\n  const list = window.data.tasks[Object.keys(window.data.tasks)\n    .find(x => window.data.tasks[x].title === dateString)];\n  if (!list) return;\n  const todayList = list.subtasks;\n  for (let task of todayList) {\n    const taskEntry = window.data.tasks[util.stripR(task)];\n    if (taskEntry.info.type === 'event' &&\n      taskEntry.info.complete !== 'complete' &&\n      !taskEntry.info.startDate.includes('--')) {\n      if (\n        taskEntry.info.startDate[0] === now[0] &&\n        taskEntry.info.startDate[1] === now[1]\n      ) {\n        var permission = Notification.requestPermission();\n        const notification = new Notification('Event: ' + taskEntry.title);\n        break;\n      } else {\n        const newDate = new Date();\n        newDate.setHours(taskEntry.info.startDate[0]);\n        newDate.setMinutes(taskEntry.info.startDate[1]);\n        newDate.setMinutes(newDate.getMinutes() - 15);\n        if (\n          taskEntry.info.type === 'event' && \n          newDate.getHours() === now[0] &&\n          newDate.getMinutes() === now[1]\n        ) {\n          var permission = Notification.requestPermission();\n          const notification = new Notification('in 15: ' + taskEntry.title);\n        }\n      }\n    }\n  }\n}\n\nexport function switchView(direction) {\n  if (!window.selected) return;\n  let parent = window.selected;\n  while (parent instanceof Task) {\n    parent = parent.props.parent;\n  }\n  parent.props.parent.changeIndex(direction);\n  updateAllSizes();\n}\n\nexport function toggleMode() {\n  if (window.data.settings.mode == 'night') {\n    window.data.settings.mode = 'day';\n  } else {\n    window.data.settings.mode = 'night';\n  }\n  display.setTheme(window.data.settings.theme);\n  localStorage.setItem('data', JSON.stringify(window.data));\n}\n\nexport function toggleSounds() {\n  if (window.data.settings.sounds == 'false') {\n    window.data.settings.sounds = 'true';\n    alert('sounds on');\n  } else {\n    window.data.settings.sounds = 'false';\n    alert('sounds off');\n  }\n}\n\nexport function focus(set) {\n  if (set != undefined) {\n    var focusSet = set;\n  } else {\n    if (window.app.current.state.bank.current.state.info.focused == 'focused') {\n      var focusSet = '';\n    } else {\n      var focusSet = 'focused';\n    }\n  }\n  if (window.selected) {\n    // set the index of the focused list to the window.selected list\n    let focusView = window.selected\n    while (focusView instanceof Task) {\n      focusView = focusView.props.parent;\n    }\n    focusView.props.parent.changeIndex(focusView.props.parent.frames\n      .findIndex(x => x.current.props.id == focusView.props.id));\n  }\n  window.app.current.state.bank.current.setState(prevState => (\n    {\n      info: {\n        ...prevState.info,\n        focused: focusSet,\n      },\n      width: processWidth(focusSet)\n    }));\n  window.app.current.state.river.current.setState(prevState => (\n    {\n      info: {\n        ...prevState.info,\n        focused: focusSet,\n      },\n      width: processWidth(focusSet),\n    }));\n  edit.saveSetting('focused', focusSet);\n  updateAllSizes();\n}\n\nexport function updateAllSizes() {\n  function update(list) {\n    if (list.current instanceof Task) { list.current.updateHeight(); }\n    for (let task of list.current.taskList.current.subtaskObjects) {\n      update(task);\n    }\n  }\n  const riverLists = window.app.current.state.river.current.frames;\n  const bankLists = window.app.current.state.bank.current.frames;\n  for (let list of riverLists.concat(bankLists)) {\n    update(list);\n  }\n}\n\nexport function setTheme(theme) {\n  const newTheme = window.themes[theme + '-' +\n    window.data.settings.mode];\n  for (let key of Object.keys(newTheme)) {\n    document.documentElement.style.setProperty(\n      key, newTheme[key]\n    );\n  }\n  window.data.settings.theme = theme;\n  localStorage.setItem('data', JSON.stringify(window.data));\n  setTimeout(updateAllSizes, 100);\n}\n\nexport function displayTable() {\n  if (window.app.current.state.displayTable === 'none' && window.selected) {\n    window.app.current.setState({displayTable: 'true'});\n  } else {\n    window.app.current.setState({displayTable: 'none'});\n  }\n  console.log(window.app.current.state.displayTable);\n}\n\nexport function playSound(sound) {\n  if (window.data.settings.sounds === 'true') {\n    sound.play();\n  }\n}\n\nexport function processWidth(focused) {\n  if (focused != 'focused') {\n    var width = Math.floor(window.innerWidth / 250);\n    $(':root').css('--frameWidth',\n      ((window.innerWidth - 40) / width) + 'px');\n  } else {\n    // focus mode\n    var width = 1;\n    $(':root').css('--frameWidth', 'calc(100% - 24px)');\n  }\n  return width;\n}\n\nexport function goToToday() {\n  searchDate(new Date().toDateString());\n}\n\nexport function searchDate(text, type) {\n  setTimeout(() => {\n    window.app.current.statusBar.current.search({ target: { value: text } });\n    window.app.current.statusBar.current.goToFirst();\n  }, 100);\n}\n\nexport function zoom() {\n  // zoom everything upwards\n  if (window.app.current.state.zoomed === 'zoomed') {\n    var zoomedSetting = '';\n  } else {\n    var zoomedSetting = 'zoomed';\n    if (!window.selected) { return }; // no zoomie\n  }\n  var zoomFrame = util.getFrame(window.selected);\n  zoomFrame.setState({ zoomed: zoomedSetting });\n  window.app.current.setState({ zoomed: zoomedSetting });\n  if (!window.zoomed) {\n    // unzoom\n    window.zoomed = window.selected;\n  } else {\n    window.zoomed = undefined;\n  }\n  setTimeout(\n    updateAllSizes, 200\n  )\n}"]},"metadata":{},"sourceType":"module"}