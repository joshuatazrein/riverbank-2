{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import $ from'jquery';import*as util from'./util';export function reset(){var accept=window.confirm('Are you sure you want to reset all window.data?');if(accept){window.data=window.resetData;localStorage.setItem('data',JSON.stringify(window.resetData));setTimeout(function(){window.location.reload();},200);}}export function restore(){window.preventReturn=true;var textarea=$('<textarea class=\"restore\"></textarea>');$('#root').append(textarea);textarea.on('keydown',function(ev){if(ev.key==='Enter'){ev.preventDefault();window.data=JSON.parse(textarea.val());localStorage.setItem('data',JSON.stringify(window.data));window.location.reload();}else if(ev.key==='Escape'){textarea.remove();setTimeout(function(){return window.preventReturn=false;},100);}});}export function backup(){alert('open console to copy window.data (file download option will be added soon)');util.consoleLog(JSON.stringify(window.data));}export function clean(){function removeDeadline(list,id){for(var _i=0,_Object$keys=Object.keys(list);_i<_Object$keys.length;_i++){var x=_Object$keys[_i];// switch it out of things\nvar deadlineList=list[x];if(deadlineList.includes(id)){deadlineList=deadlineList.splice(deadlineList.findIndex(function(x){return x===id;}),1);}}}// clean out tasks which aren't in lists\nvar _iterator=_createForOfIteratorHelper(Object.keys(window.data.tasks).filter(function(x){return!['river','bank'].includes(x);})),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var id=_step.value;var found=false;for(var _i2=0,_Object$keys2=Object.keys(window.data.tasks);_i2<_Object$keys2.length;_i2++){var containerId=_Object$keys2[_i2];if(window.data.tasks[containerId].subtasks.map(function(x){return util.stripR(x);}).includes(id)){found=true;break;}}if(found===false){delete window.data.tasks[id];removeDeadline(window.data.settings.deadlines,id);removeDeadline(window.data.settings.startdates,id);}}// clean out empty dates in the river view\n}catch(err){_iterator.e(err);}finally{_iterator.f();}var dates=window.data.tasks['river'].subtasks;var i=dates.length-1;var today=new Date().toDateString();while(window.data.tasks[dates[i]].subtasks.length===0){i--;var now=window.data.tasks[dates[i]].title;if(i==0||now===today)break;}if(i<dates.length-1){window.data.tasks['river'].subtasks=dates.slice(0,i+1);}}","map":{"version":3,"sources":["/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/src/services/saving.js"],"names":["$","util","reset","accept","window","confirm","data","resetData","localStorage","setItem","JSON","stringify","setTimeout","location","reload","restore","preventReturn","textarea","append","on","ev","key","preventDefault","parse","val","remove","backup","alert","consoleLog","clean","removeDeadline","list","id","Object","keys","x","deadlineList","includes","splice","findIndex","tasks","filter","found","containerId","subtasks","map","stripR","settings","deadlines","startdates","dates","i","length","today","Date","toDateString","now","title","slice"],"mappings":"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","sourcesContent":["import $ from 'jquery';\nimport * as util from './util';\n\nexport function reset() {\n  var accept = window.confirm('Are you sure you want to reset all window.data?');\n  if (accept) {\n    window.data = window.resetData;\n    localStorage.setItem('data', JSON.stringify(window.resetData));\n    setTimeout(function () { window.location.reload() }, 200);\n  }\n}\n\nexport function restore() {\n  window.preventReturn = true;\n  const textarea = $('<textarea class=\"restore\"></textarea>');\n  $('#root').append(textarea);\n  textarea.on('keydown', ev => {\n    if (ev.key === 'Enter') {\n      ev.preventDefault();\n      window.data = JSON.parse(textarea.val());\n      localStorage.setItem('data', JSON.stringify(window.data));\n      window.location.reload();\n    } else if (ev.key === 'Escape') {\n      textarea.remove();\n      setTimeout(() => window.preventReturn = false, 100);\n    }\n  })\n}\n\nexport function backup() {\n  alert('open console to copy window.data (file download option will be added soon)');\n  util.consoleLog(JSON.stringify(window.data));\n}\n\nexport function clean() {\n  function removeDeadline(list, id) {\n    for (let x of Object.keys(list)) {\n      // switch it out of things\n      let deadlineList = list[x];\n      if (deadlineList.includes(id)) {\n        deadlineList =\n          deadlineList.splice(deadlineList.findIndex(x => x === id), 1);\n      }\n    }\n  }\n  // clean out tasks which aren't in lists\n  for (let id of Object.keys(window.data.tasks).filter(x =>\n    !['river', 'bank'].includes(x))) {\n    let found = false;\n    for (let containerId of Object.keys(window.data.tasks)) {\n      if (window.data.tasks[containerId].subtasks.map(x =>\n        util.stripR(x)).includes(id)) {\n        found = true;\n        break;\n      }\n    }\n    if (found === false) {\n      delete window.data.tasks[id];\n      removeDeadline(window.data.settings.deadlines, id);\n      removeDeadline(window.data.settings.startdates, id);\n    }\n  }\n\n  // clean out empty dates in the river view\n  const dates = window.data.tasks['river'].subtasks;\n  let i = dates.length - 1;\n  const today = new Date().toDateString();\n\n  while(window.data.tasks[dates[i]].subtasks.length === 0) {\n    i --;\n    const now = window.data.tasks[dates[i]].title;\n    if (i == 0 || now === today) break;\n  }\n  if (i < dates.length - 1) {\n    window.data.tasks['river'].subtasks = dates.slice(0, i + 1);\n  }\n}"]},"metadata":{},"sourceType":"module"}