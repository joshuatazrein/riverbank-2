{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _objectSpread from\"/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import*as display from'../display/display';import*as util from'../util/util';import Task from'../../components/Task/Task';import List from'../../components/List/List';import TaskList from'../../components/TaskList/TaskList';import Frame from'../../components/Frame/Frame';export function deleteTask(){if(window.selected&&window.selected instanceof Task){window.undoData=localStorage.getItem('data');window.selected.deleteThis();}}export function newTask(type){// create new task after window.selected\nif(!window.selected||window.preventReturn)return;var today=new Date();var now=today.getTime();var newTask=String(now);window.data.tasks[newTask]={info:{complete:'',startDate:'',endDate:''},title:'',subtasks:[]};window.copiedTask=newTask;pasteTask(type);}export function selectTask(el,force){// make this task window.selected\nif(window.preventSelect)return;if(el instanceof TaskList){return;}window.preventSelect=true;setTimeout(function(){window.preventSelect=false;},100);if(window.selected){save(window.selected,'task');}if(window.selected===el&&!force){return;}if(window.selected instanceof Task&&window.selected!==el){window.selected.displayOptions({target:undefined},'hide');}window.selected=el;if(el instanceof Task){el.editBar.current.focus();}else if(el instanceof List){el.listInput.current.focus();}}export function save(task,saveType){// save the new window.data\nvar saveObject;if(saveType==='list'){saveObject=task.props.parent;}else{saveObject=task;}var subtasks;if(saveObject.subtasksCurrent)subtasks=saveObject.subtasksCurrent;else subtasks=saveObject.state.subtasks;window.data.tasks[util.stripR(saveObject.props.id)]={title:saveObject.state.title,info:saveObject.state.info,subtasks:subtasks};localStorage.setItem('data',JSON.stringify(window.data));}export function undo(){localStorage.setItem('data',window.undoData);setTimeout(function(){return window.location.reload();},500);}export function saveSetting(setting,value){window.data.settings[setting]=value;localStorage.setItem('data',JSON.stringify(window.data));}export function cutTask(){if(!window.selected||window.selected instanceof List)return;copyTask();window.selected.deleteThis(false);window.undoData=localStorage.getItem('data');}export function copyTask(mirror){if(!window.selected||window.selected instanceof List)return;save(window.selected);if(mirror){window.copiedTask=window.selected.props.id;}else{// only copy window.data\nvar today=new Date();var now=today.getTime();var _newTask=String(now);window.data.tasks[_newTask]=_objectSpread({},window.data.tasks[util.stripR(window.selected.props.id)]);window.copiedTask=_newTask;}}export function pasteTask(type){if(!window.selected||!window.copiedTask)return;window.undoData=localStorage.getItem('data');if(window.selected instanceof List||type==='task'){var subtasks=window.selected.state.subtasks;subtasks.splice(0,0,window.copiedTask);window.selected.setState({subtasks:subtasks});save(window.selected,'task');}else if(window.selected instanceof Task||type==='list'){var _subtasks=window.selected.state.parent.state.subtasks;var insertIndex=_subtasks.findIndex(function(x){return x===window.selected.props.id;})+1;_subtasks.splice(insertIndex,0,window.copiedTask);window.selected.state.parent.setState({subtasks:_subtasks});save(window.selected,'list');}}export function indentTask(unindent){// umm fix sometime\nif(!window.selected)return;var lastSelected=window.selected;save(window.selected);console.log(window.selected.props.parent);var subtasks=window.selected.props.parent.taskList.current.subtaskObjects;var here=subtasks.findIndex(function(x){return util.stripR(x.current.props.id)===util.stripR(window.selected.props.id);});if(unindent!==true){if(here===0)return;var taskAbove=subtasks[here-1].current;var theseSubtasks=util.getSubtasks(taskAbove);theseSubtasks.push(window.selected.props.id);var previousSubtasks=util.getSubtasks(window.selected.props.parent);previousSubtasks.splice(here,1);taskAbove.setState({subtasks:theseSubtasks});lastSelected.props.parent.setState({subtasks:previousSubtasks});save(taskAbove);save(lastSelected.props.parent);}else{if(window.selected.props.parent.props.parent instanceof Frame)return;var _subtasks2=window.selected.props.parent.props.parent.taskList.current.subtaskObjects;var _here=_subtasks2.findIndex(function(x){return x.current.props.id===window.selected.props.parent.props.id;});var _theseSubtasks=window.selected.props.parent.props.parent.state.subtasks;_theseSubtasks.splice(_here+1,0,window.selected.props.id);window.selected.props.parent.props.parent.setState({subtasks:_theseSubtasks});save(window.selected.props.parent.props.parent);var parentSubtasks=util.getSubtasks(lastSelected.props.parent);parentSubtasks.splice(parentSubtasks.findIndex(function(x){return x===lastSelected.props.id;}),1);lastSelected.props.parent.setState({subtasks:parentSubtasks});save(lastSelected.props.parent);}}export function moveTask(direction){if(!window.selected)return;var subtasks;if(window.selected.props.parent.subtasksCurrent){subtasks=window.selected.props.parent.subtasksCurrent.concat();}else{subtasks=window.selected.props.parent.state.subtasks;}var selectedPlace=subtasks.findIndex(function(x){return x===window.selected.props.id;});if(selectedPlace===0&&direction===-1)return;else if(selectedPlace===subtasks.length&&direction===1)return;var subtasksChopped;if(direction===-1){subtasksChopped=subtasks.slice(0,selectedPlace).reverse();}else{subtasksChopped=subtasks.slice(selectedPlace+1);}var insertPlace;if(window.data.settings.hideComplete==='hideComplete'){insertPlace=(subtasksChopped.findIndex(function(x){return window.data.tasks[util.stripR(x)].info.complete!=='complete';})+1)*direction;}else{insertPlace=1*direction;}var spliceTask=subtasks.splice(selectedPlace,1)[0];subtasks.splice(selectedPlace+insertPlace,0,spliceTask);window.selected.props.parent.setState({subtasks:subtasks});save(window.selected.props.parent,'task');}export function listEdit(type){if(!window.selected){alert('select a list');return;}if(type==='migrate'&&util.getFrame(window.selected).props.id==='bank'){alert('select a date');return;}var incompleteTasks=[];var subtasksCurrent=util.getList(window.selected).subtasksCurrent;function addIncomplete(task){var _iterator=_createForOfIteratorHelper(task.taskList.current.subtaskObjects),_step;try{var _loop=function _loop(){var x=_step.value;addIncomplete(x.current);if(x.current.state.info.complete!=='complete'){if(type==='clear'){x.current.toggleComplete();x.current.displayOptions({target:undefined},'hide');save(x.current);}else if(type==='migrate'&&x.current.props.id.charAt(0)!=='R'){incompleteTasks.push(x.current.props.id);subtasksCurrent.splice(subtasksCurrent.findIndex(function(y){return y===x.current.props.id;}),1);}}};for(_iterator.s();!(_step=_iterator.n()).done;){_loop();}}catch(err){_iterator.e(err);}finally{_iterator.f();}}addIncomplete(util.getList(window.selected));if(type==='migrate'){var tomorrow=new Date(util.getList(window.selected).state.title);tomorrow.setDate(tomorrow.getDate()+1);util.getList(window.selected).setState({subtasks:subtasksCurrent});save(util.getList(window.selected));display.searchDate(tomorrow.toDateString());setTimeout(function(){window.selected.setState({subtasks:window.selected.subtasksCurrent.concat(incompleteTasks)});save(window.selected);},500);}}","map":{"version":3,"sources":["/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/src/services/edit/edit.js"],"names":["display","util","Task","List","TaskList","Frame","deleteTask","window","selected","undoData","localStorage","getItem","deleteThis","newTask","type","preventReturn","today","Date","now","getTime","String","data","tasks","info","complete","startDate","endDate","title","subtasks","copiedTask","pasteTask","selectTask","el","force","preventSelect","setTimeout","save","displayOptions","target","undefined","editBar","current","focus","listInput","task","saveType","saveObject","props","parent","subtasksCurrent","state","stripR","id","setItem","JSON","stringify","undo","location","reload","saveSetting","setting","value","settings","cutTask","copyTask","mirror","splice","setState","insertIndex","findIndex","x","indentTask","unindent","lastSelected","console","log","taskList","subtaskObjects","here","taskAbove","theseSubtasks","getSubtasks","push","previousSubtasks","parentSubtasks","moveTask","direction","concat","selectedPlace","length","subtasksChopped","slice","reverse","insertPlace","hideComplete","spliceTask","listEdit","alert","getFrame","incompleteTasks","getList","addIncomplete","toggleComplete","charAt","y","tomorrow","setDate","getDate","searchDate","toDateString"],"mappings":"uZAAA,MAAO,GAAKA,CAAAA,OAAZ,KAAyB,oBAAzB,CACA,MAAO,GAAKC,CAAAA,IAAZ,KAAsB,cAAtB,CACA,MAAOC,CAAAA,IAAP,KAAiB,4BAAjB,CACA,MAAOC,CAAAA,IAAP,KAAiB,4BAAjB,CACA,MAAOC,CAAAA,QAAP,KAAqB,oCAArB,CACA,MAAOC,CAAAA,KAAP,KAAkB,8BAAlB,CAEA,MAAO,SAASC,CAAAA,UAAT,EAAsB,CAC3B,GAAIC,MAAM,CAACC,QAAP,EAAmBD,MAAM,CAACC,QAAP,WAA2BN,CAAAA,IAAlD,CAAwD,CACtDK,MAAM,CAACE,QAAP,CAAkBC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAlB,CACAJ,MAAM,CAACC,QAAP,CAAgBI,UAAhB,GACD,CACF,CAED,MAAO,SAASC,CAAAA,OAAT,CAAiBC,IAAjB,CAAuB,CAC5B;AACA,GAAI,CAACP,MAAM,CAACC,QAAR,EAAoBD,MAAM,CAACQ,aAA/B,CAA8C,OAE9C,GAAMC,CAAAA,KAAK,CAAG,GAAIC,CAAAA,IAAJ,EAAd,CACA,GAAMC,CAAAA,GAAG,CAAGF,KAAK,CAACG,OAAN,EAAZ,CACA,GAAMN,CAAAA,OAAO,CAAGO,MAAM,CAACF,GAAD,CAAtB,CACAX,MAAM,CAACc,IAAP,CAAYC,KAAZ,CAAkBT,OAAlB,EAA6B,CAC3BU,IAAI,CAAE,CAAEC,QAAQ,CAAE,EAAZ,CAAgBC,SAAS,CAAE,EAA3B,CAA+BC,OAAO,CAAE,EAAxC,CADqB,CAE3BC,KAAK,CAAE,EAFoB,CAG3BC,QAAQ,CAAE,EAHiB,CAA7B,CAKArB,MAAM,CAACsB,UAAP,CAAoBhB,OAApB,CACAiB,SAAS,CAAChB,IAAD,CAAT,CACD,CAED,MAAO,SAASiB,CAAAA,UAAT,CAAoBC,EAApB,CAAwBC,KAAxB,CAA+B,CACpC;AACA,GAAI1B,MAAM,CAAC2B,aAAX,CAA0B,OAC1B,GAAIF,EAAE,WAAY5B,CAAAA,QAAlB,CAA4B,CAC1B,OACD,CACDG,MAAM,CAAC2B,aAAP,CAAuB,IAAvB,CACAC,UAAU,CAAC,UAAY,CAAE5B,MAAM,CAAC2B,aAAP,CAAuB,KAAvB,CAA8B,CAA7C,CAA+C,GAA/C,CAAV,CACA,GAAI3B,MAAM,CAACC,QAAX,CAAqB,CACnB4B,IAAI,CAAC7B,MAAM,CAACC,QAAR,CAAkB,MAAlB,CAAJ,CACD,CACD,GAAID,MAAM,CAACC,QAAP,GAAoBwB,EAApB,EAA0B,CAACC,KAA/B,CAAsC,CACpC,OACD,CACD,GAAI1B,MAAM,CAACC,QAAP,WAA2BN,CAAAA,IAA3B,EAAmCK,MAAM,CAACC,QAAP,GAAoBwB,EAA3D,CAA+D,CAC7DzB,MAAM,CAACC,QAAP,CAAgB6B,cAAhB,CAA+B,CAAEC,MAAM,CAAEC,SAAV,CAA/B,CAAsD,MAAtD,EACD,CACDhC,MAAM,CAACC,QAAP,CAAkBwB,EAAlB,CACA,GAAIA,EAAE,WAAY9B,CAAAA,IAAlB,CAAwB,CACtB8B,EAAE,CAACQ,OAAH,CAAWC,OAAX,CAAmBC,KAAnB,GACD,CAFD,IAEO,IAAIV,EAAE,WAAY7B,CAAAA,IAAlB,CAAwB,CAC7B6B,EAAE,CAACW,SAAH,CAAaF,OAAb,CAAqBC,KAArB,GACD,CACF,CAED,MAAO,SAASN,CAAAA,IAAT,CAAcQ,IAAd,CAAoBC,QAApB,CAA8B,CACnC;AACA,GAAIC,CAAAA,UAAJ,CACA,GAAID,QAAQ,GAAK,MAAjB,CAAyB,CACvBC,UAAU,CAAGF,IAAI,CAACG,KAAL,CAAWC,MAAxB,CACD,CAFD,IAEO,CACLF,UAAU,CAAGF,IAAb,CACD,CACD,GAAIhB,CAAAA,QAAJ,CACA,GAAIkB,UAAU,CAACG,eAAf,CAAgCrB,QAAQ,CAAGkB,UAAU,CAACG,eAAtB,CAAhC,IACKrB,CAAAA,QAAQ,CAAGkB,UAAU,CAACI,KAAX,CAAiBtB,QAA5B,CACLrB,MAAM,CAACc,IAAP,CAAYC,KAAZ,CAAkBrB,IAAI,CAACkD,MAAL,CAAYL,UAAU,CAACC,KAAX,CAAiBK,EAA7B,CAAlB,EAAsD,CACpDzB,KAAK,CAAEmB,UAAU,CAACI,KAAX,CAAiBvB,KAD4B,CAEpDJ,IAAI,CAAEuB,UAAU,CAACI,KAAX,CAAiB3B,IAF6B,CAEvBK,QAAQ,CAAEA,QAFa,CAAtD,CAIAlB,YAAY,CAAC2C,OAAb,CAAqB,MAArB,CAA6BC,IAAI,CAACC,SAAL,CAAehD,MAAM,CAACc,IAAtB,CAA7B,EACD,CAED,MAAO,SAASmC,CAAAA,IAAT,EAAgB,CACrB9C,YAAY,CAAC2C,OAAb,CAAqB,MAArB,CAA6B9C,MAAM,CAACE,QAApC,EACA0B,UAAU,CAAC,iBAAM5B,CAAAA,MAAM,CAACkD,QAAP,CAAgBC,MAAhB,EAAN,EAAD,CAAiC,GAAjC,CAAV,CACD,CAED,MAAO,SAASC,CAAAA,WAAT,CAAqBC,OAArB,CAA8BC,KAA9B,CAAqC,CAC1CtD,MAAM,CAACc,IAAP,CAAYyC,QAAZ,CAAqBF,OAArB,EAAgCC,KAAhC,CACAnD,YAAY,CAAC2C,OAAb,CAAqB,MAArB,CAA6BC,IAAI,CAACC,SAAL,CAAehD,MAAM,CAACc,IAAtB,CAA7B,EACD,CAED,MAAO,SAAS0C,CAAAA,OAAT,EAAmB,CACxB,GAAI,CAACxD,MAAM,CAACC,QAAR,EAAoBD,MAAM,CAACC,QAAP,WAA2BL,CAAAA,IAAnD,CAAyD,OACzD6D,QAAQ,GACRzD,MAAM,CAACC,QAAP,CAAgBI,UAAhB,CAA2B,KAA3B,EACAL,MAAM,CAACE,QAAP,CAAkBC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAlB,CACD,CAED,MAAO,SAASqD,CAAAA,QAAT,CAAkBC,MAAlB,CAA0B,CAC/B,GAAI,CAAC1D,MAAM,CAACC,QAAR,EAAoBD,MAAM,CAACC,QAAP,WAA2BL,CAAAA,IAAnD,CAAyD,OACzDiC,IAAI,CAAC7B,MAAM,CAACC,QAAR,CAAJ,CACA,GAAIyD,MAAJ,CAAY,CACV1D,MAAM,CAACsB,UAAP,CAAoBtB,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBK,EAA1C,CACD,CAFD,IAEO,CACL;AACA,GAAMpC,CAAAA,KAAK,CAAG,GAAIC,CAAAA,IAAJ,EAAd,CACA,GAAMC,CAAAA,GAAG,CAAGF,KAAK,CAACG,OAAN,EAAZ,CACA,GAAMN,CAAAA,QAAO,CAAGO,MAAM,CAACF,GAAD,CAAtB,CACAX,MAAM,CAACc,IAAP,CAAYC,KAAZ,CAAkBT,QAAlB,mBAAkCN,MAAM,CAACc,IAAP,CAAYC,KAAZ,CAAkBrB,IAAI,CAACkD,MAAL,CAAY5C,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBK,EAAlC,CAAlB,CAAlC,EACA7C,MAAM,CAACsB,UAAP,CAAoBhB,QAApB,CACD,CACF,CAED,MAAO,SAASiB,CAAAA,SAAT,CAAmBhB,IAAnB,CAAyB,CAC5B,GAAI,CAACP,MAAM,CAACC,QAAR,EAAoB,CAACD,MAAM,CAACsB,UAAhC,CAA4C,OAC9CtB,MAAM,CAACE,QAAP,CAAkBC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAlB,CACA,GAAIJ,MAAM,CAACC,QAAP,WAA2BL,CAAAA,IAA3B,EAAmCW,IAAI,GAAK,MAAhD,CAAwD,CACtD,GAAMc,CAAAA,QAAQ,CAAGrB,MAAM,CAACC,QAAP,CAAgB0C,KAAhB,CAAsBtB,QAAvC,CACAA,QAAQ,CAACsC,MAAT,CAAgB,CAAhB,CAAmB,CAAnB,CAAsB3D,MAAM,CAACsB,UAA7B,EACAtB,MAAM,CAACC,QAAP,CAAgB2D,QAAhB,CAAyB,CAAEvC,QAAQ,CAAEA,QAAZ,CAAzB,EACAQ,IAAI,CAAC7B,MAAM,CAACC,QAAR,CAAkB,MAAlB,CAAJ,CACD,CALD,IAKO,IAAID,MAAM,CAACC,QAAP,WAA2BN,CAAAA,IAA3B,EAAmCY,IAAI,GAAK,MAAhD,CAAwD,CAC7D,GAAMc,CAAAA,SAAQ,CAAGrB,MAAM,CAACC,QAAP,CAAgB0C,KAAhB,CAAsBF,MAAtB,CAA6BE,KAA7B,CAAmCtB,QAApD,CACA,GAAMwC,CAAAA,WAAW,CAAGxC,SAAQ,CAACyC,SAAT,CAAmB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,GAAK/D,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBK,EAAhC,EAApB,EAA0D,CAA9E,CACAxB,SAAQ,CAACsC,MAAT,CAAgBE,WAAhB,CAA6B,CAA7B,CAAgC7D,MAAM,CAACsB,UAAvC,EACAtB,MAAM,CAACC,QAAP,CAAgB0C,KAAhB,CAAsBF,MAAtB,CAA6BmB,QAA7B,CAAsC,CAAEvC,QAAQ,CAAEA,SAAZ,CAAtC,EACAQ,IAAI,CAAC7B,MAAM,CAACC,QAAR,CAAkB,MAAlB,CAAJ,CACD,CACF,CAED,MAAO,SAAS+D,CAAAA,UAAT,CAAoBC,QAApB,CAA8B,CACnC;AACA,GAAI,CAACjE,MAAM,CAACC,QAAZ,CAAsB,OACtB,GAAMiE,CAAAA,YAAY,CAAGlE,MAAM,CAACC,QAA5B,CACA4B,IAAI,CAAC7B,MAAM,CAACC,QAAR,CAAJ,CACAkE,OAAO,CAACC,GAAR,CAAYpE,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAlC,EACA,GAAMpB,CAAAA,QAAQ,CACZrB,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6B4B,QAA7B,CAAsCnC,OAAtC,CAA8CoC,cADhD,CAEA,GAAMC,CAAAA,IAAI,CAAGlD,QAAQ,CAClByC,SADU,CACA,SAAAC,CAAC,QACZrE,CAAAA,IAAI,CAACkD,MAAL,CAAYmB,CAAC,CAAC7B,OAAF,CAAUM,KAAV,CAAgBK,EAA5B,IAAoCnD,IAAI,CAACkD,MAAL,CAAY5C,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBK,EAAlC,CADxB,EADD,CAAb,CAGE,GAAIoB,QAAQ,GAAK,IAAjB,CAAuB,CACvB,GAAIM,IAAI,GAAK,CAAb,CAAgB,OAChB,GAAMC,CAAAA,SAAS,CAAGnD,QAAQ,CAACkD,IAAI,CAAG,CAAR,CAAR,CAAmBrC,OAArC,CACA,GAAMuC,CAAAA,aAAa,CAAG/E,IAAI,CAACgF,WAAL,CAAiBF,SAAjB,CAAtB,CACAC,aAAa,CAACE,IAAd,CAAmB3E,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBK,EAAzC,EACA,GAAM+B,CAAAA,gBAAgB,CAAGlF,IAAI,CAACgF,WAAL,CAAiB1E,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAvC,CAAzB,CACAmC,gBAAgB,CAACjB,MAAjB,CAAwBY,IAAxB,CAA8B,CAA9B,EACIC,SAAS,CAACZ,QAAV,CAAoB,CAAEvC,QAAQ,CAAEoD,aAAZ,CAApB,EACAP,YAAY,CAAC1B,KAAb,CAAmBC,MAAnB,CAA0BmB,QAA1B,CAAmC,CAAEvC,QAAQ,CAAEuD,gBAAZ,CAAnC,EACA/C,IAAI,CAAC2C,SAAD,CAAJ,CACA3C,IAAI,CAACqC,YAAY,CAAC1B,KAAb,CAAmBC,MAApB,CAAJ,CACD,CAXH,IAWS,CACT,GAAIzC,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6BD,KAA7B,CAAmCC,MAAnC,WAAqD3C,CAAAA,KAAzD,CAAgE,OAChE,GAAMuB,CAAAA,UAAQ,CAAGrB,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6BD,KAA7B,CAAmCC,MAAnC,CACd4B,QADc,CACLnC,OADK,CACGoC,cADpB,CAEA,GAAMC,CAAAA,KAAI,CAAGlD,UAAQ,CAACyC,SAAT,CACX,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAAC7B,OAAF,CAAUM,KAAV,CAAgBK,EAAhB,GAAuB7C,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6BD,KAA7B,CAAmCK,EAA9D,EADU,CAAb,CAEA,GAAM4B,CAAAA,cAAa,CAAGzE,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6BD,KAA7B,CAAmCC,MAAnC,CAA0CE,KAA1C,CAAgDtB,QAAtE,CACAoD,cAAa,CAACd,MAAd,CAAqBY,KAAI,CAAG,CAA5B,CAA+B,CAA/B,CAAkCvE,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBK,EAAxD,EACI7C,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6BD,KAA7B,CAAmCC,MAAnC,CAA0CmB,QAA1C,CAAmD,CAAEvC,QAAQ,CAAEoD,cAAZ,CAAnD,EACJ5C,IAAI,CAAC7B,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6BD,KAA7B,CAAmCC,MAApC,CAAJ,CACA,GAAMoC,CAAAA,cAAc,CAAGnF,IAAI,CAACgF,WAAL,CAAiBR,YAAY,CAAC1B,KAAb,CAAmBC,MAApC,CAAvB,CACAoC,cAAc,CAAClB,MAAf,CAAsBkB,cAAc,CAACf,SAAf,CAAyB,SAAAC,CAAC,QAC9CA,CAAAA,CAAC,GAAKG,YAAY,CAAC1B,KAAb,CAAmBK,EADqB,EAA1B,CAAtB,CACgC,CADhC,EAEAqB,YAAY,CAAC1B,KAAb,CAAmBC,MAAnB,CAA0BmB,QAA1B,CAAmC,CAAEvC,QAAQ,CAAEwD,cAAZ,CAAnC,EACAhD,IAAI,CAACqC,YAAY,CAAC1B,KAAb,CAAmBC,MAApB,CAAJ,CACD,CACF,CAED,MAAO,SAASqC,CAAAA,QAAT,CAAkBC,SAAlB,CAA6B,CAClC,GAAI,CAAC/E,MAAM,CAACC,QAAZ,CAAsB,OACtB,GAAIoB,CAAAA,QAAJ,CACA,GAAIrB,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6BC,eAAjC,CAAkD,CAChDrB,QAAQ,CAAGrB,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6BC,eAA7B,CAA6CsC,MAA7C,EAAX,CACD,CAFD,IAEO,CACL3D,QAAQ,CAAGrB,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6BE,KAA7B,CAAmCtB,QAA9C,CACD,CACD,GAAI4D,CAAAA,aAAa,CACf5D,QAAQ,CAACyC,SAAT,CAAmB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,GAAK/D,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBK,EAAhC,EAApB,CADF,CAEA,GAAIoC,aAAa,GAAK,CAAlB,EAAuBF,SAAS,GAAK,CAAC,CAA1C,CAA6C,OAA7C,IACK,IAAIE,aAAa,GAAK5D,QAAQ,CAAC6D,MAA3B,EACJH,SAAS,GAAK,CADd,CACiB,OACtB,GAAII,CAAAA,eAAJ,CACA,GAAIJ,SAAS,GAAK,CAAC,CAAnB,CAAsB,CACpBI,eAAe,CAAG9D,QAAQ,CAAC+D,KAAT,CAAe,CAAf,CAAkBH,aAAlB,EAAiCI,OAAjC,EAAlB,CACD,CAFD,IAEO,CACLF,eAAe,CAAG9D,QAAQ,CAAC+D,KAAT,CAAeH,aAAa,CAAG,CAA/B,CAAlB,CACD,CACD,GAAIK,CAAAA,WAAJ,CACA,GAAItF,MAAM,CAACc,IAAP,CAAYyC,QAAZ,CAAqBgC,YAArB,GAAsC,cAA1C,CAA0D,CACxDD,WAAW,CAAG,CAACH,eAAe,CAACrB,SAAhB,CAA0B,SAAAC,CAAC,QACxC/D,CAAAA,MAAM,CAACc,IAAP,CAAYC,KAAZ,CAAkBrB,IAAI,CAACkD,MAAL,CAAYmB,CAAZ,CAAlB,EAAkC/C,IAAlC,CAAuCC,QAAvC,GAAoD,UADZ,EAA3B,EACqD,CADtD,EAC2D8D,SADzE,CAED,CAHD,IAGO,CACLO,WAAW,CAAG,EAAIP,SAAlB,CACD,CACD,GAAMS,CAAAA,UAAU,CAAGnE,QAAQ,CAACsC,MAAT,CAAgBsB,aAAhB,CAA+B,CAA/B,EAAkC,CAAlC,CAAnB,CACA5D,QAAQ,CAACsC,MAAT,CAAgBsB,aAAa,CAAGK,WAAhC,CAA6C,CAA7C,CAAgDE,UAAhD,EACAxF,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAtB,CAA6BmB,QAA7B,CAAsC,CAAEvC,QAAQ,CAAEA,QAAZ,CAAtC,EACAQ,IAAI,CAAC7B,MAAM,CAACC,QAAP,CAAgBuC,KAAhB,CAAsBC,MAAvB,CAA+B,MAA/B,CAAJ,CACD,CAED,MAAO,SAASgD,CAAAA,QAAT,CAAkBlF,IAAlB,CAAwB,CAC7B,GAAI,CAACP,MAAM,CAACC,QAAZ,CAAsB,CACpByF,KAAK,CAAC,eAAD,CAAL,CACA,OACD,CACD,GAAInF,IAAI,GAAK,SAAT,EAAsBb,IAAI,CAACiG,QAAL,CAAc3F,MAAM,CAACC,QAArB,EAA+BuC,KAA/B,CAAqCK,EAArC,GAA4C,MAAtE,CAA8E,CAC5E6C,KAAK,CAAC,eAAD,CAAL,CACA,OACD,CACD,GAAIE,CAAAA,eAAe,CAAG,EAAtB,CACA,GAAIlD,CAAAA,eAAe,CAAGhD,IAAI,CAACmG,OAAL,CAAa7F,MAAM,CAACC,QAApB,EAA8ByC,eAApD,CACA,QAASoD,CAAAA,aAAT,CAAuBzD,IAAvB,CAA6B,0CACbA,IAAI,CAACgC,QAAL,CAAcnC,OAAd,CAAsBoC,cADT,0CAClBP,CAAAA,CADkB,aAEzB+B,aAAa,CAAC/B,CAAC,CAAC7B,OAAH,CAAb,CACA,GAAI6B,CAAC,CAAC7B,OAAF,CAAUS,KAAV,CAAgB3B,IAAhB,CAAqBC,QAArB,GAAkC,UAAtC,CAAkD,CAChD,GAAIV,IAAI,GAAK,OAAb,CAAsB,CACpBwD,CAAC,CAAC7B,OAAF,CAAU6D,cAAV,GACAhC,CAAC,CAAC7B,OAAF,CAAUJ,cAAV,CAAyB,CAACC,MAAM,CAAEC,SAAT,CAAzB,CAA8C,MAA9C,EACAH,IAAI,CAACkC,CAAC,CAAC7B,OAAH,CAAJ,CACD,CAJD,IAIO,IAAI3B,IAAI,GAAK,SAAT,EACTwD,CAAC,CAAC7B,OAAF,CAAUM,KAAV,CAAgBK,EAAhB,CAAmBmD,MAAnB,CAA0B,CAA1B,IAAiC,GAD5B,CACiC,CACtCJ,eAAe,CAACjB,IAAhB,CAAqBZ,CAAC,CAAC7B,OAAF,CAAUM,KAAV,CAAgBK,EAArC,EACAH,eAAe,CAACiB,MAAhB,CAAuBjB,eAAe,CACnCoB,SADoB,CACV,SAAAmC,CAAC,QAAIA,CAAAA,CAAC,GAAKlC,CAAC,CAAC7B,OAAF,CAAUM,KAAV,CAAgBK,EAA1B,EADS,CAAvB,CAC6C,CAD7C,EAED,CACF,CAdwB,EAC3B,+CAAoD,SAcnD,CAf0B,qDAgB5B,CACDiD,aAAa,CAACpG,IAAI,CAACmG,OAAL,CAAa7F,MAAM,CAACC,QAApB,CAAD,CAAb,CACA,GAAIM,IAAI,GAAK,SAAb,CAAwB,CACtB,GAAM2F,CAAAA,QAAQ,CAAG,GAAIxF,CAAAA,IAAJ,CAAShB,IAAI,CAACmG,OAAL,CAAa7F,MAAM,CAACC,QAApB,EAA8B0C,KAA9B,CAAoCvB,KAA7C,CAAjB,CACA8E,QAAQ,CAACC,OAAT,CAAiBD,QAAQ,CAACE,OAAT,GAAqB,CAAtC,EACA1G,IAAI,CAACmG,OAAL,CAAa7F,MAAM,CAACC,QAApB,EAA8B2D,QAA9B,CAAuC,CACrCvC,QAAQ,CAAEqB,eAD2B,CAAvC,EAGAb,IAAI,CAACnC,IAAI,CAACmG,OAAL,CAAa7F,MAAM,CAACC,QAApB,CAAD,CAAJ,CACAR,OAAO,CAAC4G,UAAR,CAAmBH,QAAQ,CAACI,YAAT,EAAnB,EACA1E,UAAU,CAAC,UAAM,CACf5B,MAAM,CAACC,QAAP,CAAgB2D,QAAhB,CACE,CAAEvC,QAAQ,CAAErB,MAAM,CAACC,QAAP,CAAgByC,eAAhB,CAAgCsC,MAAhC,CAAuCY,eAAvC,CAAZ,CADF,EAEA/D,IAAI,CAAC7B,MAAM,CAACC,QAAR,CAAJ,CACD,CAJS,CAIP,GAJO,CAAV,CAKD,CACF","sourcesContent":["import * as display from '../display/display';\nimport * as util from '../util/util';\nimport Task from '../../components/Task/Task';\nimport List from '../../components/List/List';\nimport TaskList from '../../components/TaskList/TaskList';\nimport Frame from '../../components/Frame/Frame';\n\nexport function deleteTask() {\n  if (window.selected && window.selected instanceof Task) {\n    window.undoData = localStorage.getItem('data');\n    window.selected.deleteThis();\n  }\n}\n\nexport function newTask(type) {\n  // create new task after window.selected\n  if (!window.selected || window.preventReturn) return;\n\n  const today = new Date();\n  const now = today.getTime();\n  const newTask = String(now);\n  window.data.tasks[newTask] = {\n    info: { complete: '', startDate: '', endDate: '' },\n    title: '',\n    subtasks: [],\n  };\n  window.copiedTask = newTask;\n  pasteTask(type);\n}\n\nexport function selectTask(el, force) {\n  // make this task window.selected\n  if (window.preventSelect) return\n  if (el instanceof TaskList) {\n    return\n  }\n  window.preventSelect = true;\n  setTimeout(function () { window.preventSelect = false }, 100);\n  if (window.selected) {\n    save(window.selected, 'task');\n  }\n  if (window.selected === el && !force) {\n    return;\n  }\n  if (window.selected instanceof Task && window.selected !== el) {\n    window.selected.displayOptions({ target: undefined }, 'hide');\n  }\n  window.selected = el;\n  if (el instanceof Task) {\n    el.editBar.current.focus();\n  } else if (el instanceof List) {\n    el.listInput.current.focus();\n  }\n}\n\nexport function save(task, saveType) {\n  // save the new window.data\n  var saveObject;\n  if (saveType === 'list') {\n    saveObject = task.props.parent;\n  } else {\n    saveObject = task;\n  }\n  var subtasks;\n  if (saveObject.subtasksCurrent) subtasks = saveObject.subtasksCurrent;\n  else subtasks = saveObject.state.subtasks;\n  window.data.tasks[util.stripR(saveObject.props.id)] = {\n    title: saveObject.state.title,\n    info: saveObject.state.info, subtasks: subtasks\n  };\n  localStorage.setItem('data', JSON.stringify(window.data));\n}\n\nexport function undo() {\n  localStorage.setItem('data', window.undoData);\n  setTimeout(() => window.location.reload(), 500);\n}\n\nexport function saveSetting(setting, value) {\n  window.data.settings[setting] = value;\n  localStorage.setItem('data', JSON.stringify(window.data));\n}\n\nexport function cutTask() {\n  if (!window.selected || window.selected instanceof List) return;\n  copyTask();\n  window.selected.deleteThis(false);\n  window.undoData = localStorage.getItem('data');\n}\n\nexport function copyTask(mirror) {\n  if (!window.selected || window.selected instanceof List) return;\n  save(window.selected);\n  if (mirror) {\n    window.copiedTask = window.selected.props.id;\n  } else {\n    // only copy window.data\n    const today = new Date();\n    const now = today.getTime();\n    const newTask = String(now);\n    window.data.tasks[newTask] = { ...window.data.tasks[util.stripR(window.selected.props.id)] };\n    window.copiedTask = newTask;\n  }\n}\n\nexport function pasteTask(type) {\n    if (!window.selected || !window.copiedTask) return;\n  window.undoData = localStorage.getItem('data');\n  if (window.selected instanceof List || type === 'task') {\n    const subtasks = window.selected.state.subtasks;\n    subtasks.splice(0, 0, window.copiedTask);\n    window.selected.setState({ subtasks: subtasks });\n    save(window.selected, 'task');\n  } else if (window.selected instanceof Task || type === 'list') {\n    const subtasks = window.selected.state.parent.state.subtasks;\n    const insertIndex = subtasks.findIndex(x => x === window.selected.props.id) + 1;\n    subtasks.splice(insertIndex, 0, window.copiedTask);\n    window.selected.state.parent.setState({ subtasks: subtasks });\n    save(window.selected, 'list');\n  }\n}\n\nexport function indentTask(unindent) {\n  // umm fix sometime\n  if (!window.selected) return;\n  const lastSelected = window.selected;\n  save(window.selected);\n  console.log(window.selected.props.parent);\n  const subtasks =\n    window.selected.props.parent.taskList.current.subtaskObjects;\n  const here = subtasks\n    .findIndex(x => \n    util.stripR(x.current.props.id) === util.stripR(window.selected.props.id));\n    if (unindent !== true) {\n    if (here === 0) return;\n    const taskAbove = subtasks[here - 1].current;\n    const theseSubtasks = util.getSubtasks(taskAbove);\n    theseSubtasks.push(window.selected.props.id);\n    const previousSubtasks = util.getSubtasks(window.selected.props.parent);\n    previousSubtasks.splice(here, 1);\n        taskAbove.setState( { subtasks: theseSubtasks });\n        lastSelected.props.parent.setState({ subtasks: previousSubtasks });\n        save(taskAbove);\n        save(lastSelected.props.parent);\n      } else {\n    if (window.selected.props.parent.props.parent instanceof Frame) return;\n    const subtasks = window.selected.props.parent.props.parent\n      .taskList.current.subtaskObjects;\n    const here = subtasks.findIndex(\n      x => x.current.props.id === window.selected.props.parent.props.id);\n    const theseSubtasks = window.selected.props.parent.props.parent.state.subtasks;\n    theseSubtasks.splice(here + 1, 0, window.selected.props.id);\n        window.selected.props.parent.props.parent.setState({ subtasks: theseSubtasks });\n    save(window.selected.props.parent.props.parent);\n    const parentSubtasks = util.getSubtasks(lastSelected.props.parent);\n    parentSubtasks.splice(parentSubtasks.findIndex(x => \n      x === lastSelected.props.id), 1);\n    lastSelected.props.parent.setState({ subtasks: parentSubtasks });\n    save(lastSelected.props.parent);\n  }\n}\n\nexport function moveTask(direction) {\n  if (!window.selected) return;\n  var subtasks;\n  if (window.selected.props.parent.subtasksCurrent) {\n    subtasks = window.selected.props.parent.subtasksCurrent.concat();\n  } else {\n    subtasks = window.selected.props.parent.state.subtasks;\n  }\n  let selectedPlace =\n    subtasks.findIndex(x => x === window.selected.props.id);\n  if (selectedPlace === 0 && direction === -1) return;\n  else if (selectedPlace === subtasks.length\n    && direction === 1) return;\n  var subtasksChopped;\n  if (direction === -1) {\n    subtasksChopped = subtasks.slice(0, selectedPlace).reverse();\n  } else {\n    subtasksChopped = subtasks.slice(selectedPlace + 1);\n  }\n  var insertPlace;\n  if (window.data.settings.hideComplete === 'hideComplete') {\n    insertPlace = (subtasksChopped.findIndex(x =>\n      window.data.tasks[util.stripR(x)].info.complete !== 'complete') + 1) * direction;\n  } else {\n    insertPlace = 1 * direction;\n  }\n  const spliceTask = subtasks.splice(selectedPlace, 1)[0];\n  subtasks.splice(selectedPlace + insertPlace, 0, spliceTask);\n  window.selected.props.parent.setState({ subtasks: subtasks });\n  save(window.selected.props.parent, 'task');\n}\n\nexport function listEdit(type) {\n  if (!window.selected) {\n    alert('select a list');\n    return;\n  }\n  if (type === 'migrate' && util.getFrame(window.selected).props.id === 'bank') {\n    alert('select a date');\n    return;\n  }\n  var incompleteTasks = [];\n  var subtasksCurrent = util.getList(window.selected).subtasksCurrent;\n  function addIncomplete(task) {\n    for (let x of task.taskList.current.subtaskObjects) {\n      addIncomplete(x.current);\n      if (x.current.state.info.complete !== 'complete') {\n        if (type === 'clear') {\n          x.current.toggleComplete();\n          x.current.displayOptions({target: undefined}, 'hide');\n          save(x.current);\n        } else if (type === 'migrate' && \n          x.current.props.id.charAt(0) !== 'R') {\n          incompleteTasks.push(x.current.props.id);\n          subtasksCurrent.splice(subtasksCurrent\n            .findIndex(y => y === x.current.props.id), 1);\n        }\n      }\n    }\n  }\n  addIncomplete(util.getList(window.selected));\n  if (type === 'migrate') {\n    const tomorrow = new Date(util.getList(window.selected).state.title);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n    util.getList(window.selected).setState({\n      subtasks: subtasksCurrent\n    });\n    save(util.getList(window.selected));\n    display.searchDate(tomorrow.toDateString());\n    setTimeout(() => {\n      window.selected.setState(\n        { subtasks: window.selected.subtasksCurrent.concat(incompleteTasks) });\n      save(window.selected);\n    }, 500);\n  }\n}"]},"metadata":{},"sourceType":"module"}