{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _classCallCheck from\"/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'./List.css';import*as display from'../../services/display/display';import*as edit from'../../services/edit/edit';import*as util from'../../services/util/util';import TaskList from'../TaskList/TaskList';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var List=/*#__PURE__*/function(_React$Component){_inherits(List,_React$Component);var _super=_createSuper(List);function List(props){var _this;_classCallCheck(this,List);_this=_super.call(this,props);_this.updateHeights=function(){return;if(!_this.taskList.current)return;var objects=_this.taskList.current.subtaskObjects.filter(function(x){return x.current.isComplete()!=='complete';});for(var i=0;i<objects.length-1;i++){var thisObject=objects[i].current;var nextObject=objects[i+1].current;var minHeight=1;if(thisObject.state.info.type==='event'){var endDate=thisObject.state.info.endDate;if(!endDate.includes('--')){// rounded to 30 minutes\nminHeight=(endDate[0]*60+endDate[1])/60;}else if(nextObject.state.info.type==='event'){// no end date\nvar startDate=nextObject.state.info.startDate;if(!startDate.includes('--')){var difference=util.getTime(startDate)-util.getTime(thisObject.state.info.startDate);minHeight=difference/60;}}}thisObject.setState({minHeight:minHeight});}if(objects.length>0){var _minHeight=1;var lastObject=objects[objects.length-1].current;var _endDate=lastObject.state.info.endDate;if(lastObject.state.info.type==='event'&&!_endDate.includes('--')){// rounded to 30 minutes\n_minHeight=(_endDate[0]*60+_endDate[1])/60;}lastObject.setState({minHeight:_minHeight});}};_this.dropTask=function(ev,type){edit.selectTask(window.draggedTask);var listParent=window.selected.props.parent;edit.cutTask();edit.save(listParent,'list');window.preventSelect=false;setTimeout(function(){edit.selectTask(_assertThisInitialized(_this));if(type==='subtask'){edit.pasteTask('task');}else if(type==='task'){edit.pasteTask();}},100);_this.setState({taskDrop:false,subtaskDrop:false});ev.stopPropagation();};_this.taskList=/*#__PURE__*/React.createRef();_this.state={// filter subtasks here\nsubtasks:props.subtasks,title:props.title,info:{},zoomed:''};return _this;}_createClass(List,[{key:\"changeTitle\",value:function changeTitle(ev){this.setState({title:ev.target.value});}},{key:\"sortList\",value:function sortList(){// sort the given list by time\nvar ordered=true;var currentTime=0;var _iterator=_createForOfIteratorHelper(this.subtasksCurrent),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var x=_step.value;var task=window.data.tasks[util.stripR(x)];var thisTime=util.getTime(task.info.startDate);if(task.info.type==='event'&&thisTime<currentTime){ordered=false;break;}currentTime=thisTime;}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(ordered)return;// sort the list\nvar sortedList=[];var currentSort=['start'];var _iterator2=_createForOfIteratorHelper(this.subtasksCurrent),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _task=_step2.value;var taskData=window.data.tasks[util.stripR(_task)];if(taskData.info.type==='event'&&!taskData.info.startDate.includes('--')){sortedList.push(currentSort);currentSort=[];currentSort.push(_task);}else{currentSort.push(_task);}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}sortedList.push(currentSort);// add last thing\nsortedList=sortedList.sort(function(a,b){if(a[0]==='start'||a.length===0){a=a.splice(0,1);return-1;}else if(b[0]==='start'||b.length===0){b=b.splice(0,1);return 1;}else{return util.getTime(window.data.tasks[util.stripR(a[0])].info.startDate)-util.getTime(window.data.tasks[util.stripR(b[0])].info.startDate);}}).flat();this.subtasksCurrent=sortedList;}},{key:\"render\",value:function render(){var _this2=this;var selectThis=function selectThis(){edit.selectTask(_this2);};this.changeTitle=this.changeTitle.bind(this);this.listInput=/*#__PURE__*/React.createRef();this.subtasksCurrent=this.state.subtasks.filter(function(x){return!(x.charAt(0)==='R'&&!_this2.props.repeats.includes(x))&&window.data.tasks[util.stripR(x)];});if(this.props.parent.props.id==='river'){var _iterator3=_createForOfIteratorHelper(this.props.repeats),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var task=_step3.value;if(!this.subtasksCurrent.includes(task)&&!this.subtasksCurrent.includes(util.stripR(task))){this.subtasksCurrent.push(task);}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}if(util.getFrame(this).props.id==='river'){this.sortList();setTimeout(this.updateHeights,100);}var drop=function drop(ev){edit.selectTask(window.draggedTask);var listParent=window.selected.props.parent;edit.cutTask();edit.save(listParent,'list');window.preventSelect=false;setTimeout(function(){edit.selectTask(_this2);if(ev.metaKey){edit.pasteTask('task');}else{edit.pasteTask();}},100);ev.stopPropagation();};var dragOver=function dragOver(ev){ev.preventDefault();ev.dataTransfer.dropEffect='all';};var dragEnter=function dragEnter(ev){ev.dataTransfer.dropEffect='all';};var dragLeave=function dragLeave(ev){ev.dataTransfer.dropEffect='all';};return/*#__PURE__*/_jsxs(\"div\",{className:'list '+this.state.zoomed,onClick:selectThis,onContextMenu:selectThis,children:[/*#__PURE__*/_jsx(\"div\",{className:\"listInputBackground\",onDragEnter:function onDragEnter(){console.log(window.draggedTask.props.id);if(window.draggedTask.props.id===_this2.props.id)return;_this2.setState({taskDrop:true});},onDragLeave:function onDragLeave(){return _this2.setState({taskDrop:false});},onDrop:function onDrop(ev){return _this2.dropTask(ev,'subtask');},children:this.props.parent.props.id==='bank'?/*#__PURE__*/_jsx(\"input\",{className:\"listInput\",value:this.state.title,onChange:this.changeTitle,ref:this.listInput,onDragOver:dragOver,onDragEnter:dragEnter,onDragLeave:dragLeave}):/*#__PURE__*/_jsx(\"input\",{readOnly:true,className:\"listInput listTitle\",value:util.dateFormat(this.state.title),ref:this.listInput,onDragOver:dragOver,onDragEnter:dragEnter})}),/*#__PURE__*/_jsxs(\"div\",{className:\"listFrame\",children:[this.props.parent.props.id==='river'&&this.props.deadlines&&/*#__PURE__*/_jsx(\"ul\",{children:this.props.deadlines.map(function(x){try{return/*#__PURE__*/_jsx(\"li\",{className:\"deadline\",onClick:function onClick(){return display.searchDate(window.data.tasks[util.stripR(x)].title,'start');},children:window.data.tasks[util.stripR(x)].title},String(x));}catch(_unused){return undefined;}})}),this.props.parent.props.id==='river'&&this.props.startdates&&/*#__PURE__*/_jsx(\"ul\",{children:this.props.startdates.map(function(x){return/*#__PURE__*/_jsx(\"li\",{className:\"startdate\",onClick:function onClick(){return display.searchDate(window.data.tasks[util.stripR(x)].title,'start');},children:window.data.tasks[util.stripR(x)].title},String(x));})}),/*#__PURE__*/_jsx(\"div\",{className:\"dropArea \".concat(this.state.taskDrop?'droppable':''),onDragOver:dragOver}),/*#__PURE__*/_jsx(TaskList,{ref:this.taskList,subtasks:this.subtasksCurrent,parent:this})]})]});}}]);return List;}(React.Component);export{List as default};","map":{"version":3,"sources":["/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/src/components/List/List.js"],"names":["React","display","edit","util","TaskList","List","props","updateHeights","taskList","current","objects","subtaskObjects","filter","x","isComplete","i","length","thisObject","nextObject","minHeight","state","info","type","endDate","includes","startDate","difference","getTime","setState","lastObject","dropTask","ev","selectTask","window","draggedTask","listParent","selected","parent","cutTask","save","preventSelect","setTimeout","pasteTask","taskDrop","subtaskDrop","stopPropagation","createRef","subtasks","title","zoomed","target","value","ordered","currentTime","subtasksCurrent","task","data","tasks","stripR","thisTime","sortedList","currentSort","taskData","push","sort","a","b","splice","flat","selectThis","changeTitle","bind","listInput","charAt","repeats","id","getFrame","sortList","drop","metaKey","dragOver","preventDefault","dataTransfer","dropEffect","dragEnter","dragLeave","console","log","dateFormat","deadlines","map","searchDate","String","undefined","startdates","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './List.css';\nimport * as display from '../../services/display/display';\nimport * as edit from '../../services/edit/edit';\nimport * as util from '../../services/util/util';\nimport TaskList from '../TaskList/TaskList';\n\nexport default class List extends React.Component {\n  constructor(props) {\n    super(props);\n    this.taskList = React.createRef();\n    this.state = {\n      // filter subtasks here\n      subtasks: props.subtasks,\n      title: props.title,\n      info: {}, zoomed: ''\n    };\n  }\n  changeTitle(ev) {\n    this.setState({ title: ev.target.value });\n  }\n  sortList() {\n    // sort the given list by time\n    let ordered = true;\n    let currentTime = 0;\n    for (let x of this.subtasksCurrent) {\n      const task = window.data.tasks[util.stripR(x)];\n      const thisTime = util.getTime(task.info.startDate);\n      if (\n        task.info.type === 'event' &&\n        thisTime < currentTime\n      ) {\n        ordered = false;\n        break;\n      }\n      currentTime = thisTime;\n    }\n    if (ordered) return;\n    // sort the list\n    let sortedList = [];\n    let currentSort = ['start'];\n    for (let task of this.subtasksCurrent) {\n      const taskData = window.data.tasks[util.stripR(task)];\n      if (taskData.info.type === 'event' && \n        !taskData.info.startDate.includes('--')) {\n        sortedList.push(currentSort);\n        currentSort = [];\n        currentSort.push(task);\n      } else {\n        currentSort.push(task);\n      }\n    }\n    sortedList.push(currentSort); // add last thing\n    sortedList = sortedList.sort((a, b) => {\n      if (a[0] === 'start' || a.length === 0) {\n        a = a.splice(0, 1);\n        return -1;\n      } else if (b[0] === 'start' || b.length === 0) {\n        b = b.splice(0, 1);\n        return 1;\n      } else {\n        return util.getTime(window.data.tasks[util.stripR(a[0])].info.startDate) - \n          util.getTime(window.data.tasks[util.stripR(b[0])].info.startDate)\n      }\n    }).flat();\n    this.subtasksCurrent = sortedList;\n  }\n  updateHeights = () => {\n    return\n    if (!this.taskList.current) return;\n    const objects = this.taskList.current.subtaskObjects.filter(\n      x => x.current.isComplete() !== 'complete'\n    );\n    for (\n      let i = 0; i < objects.length - 1; i++\n    ) {\n      const thisObject = objects[i].current;\n      const nextObject = objects[i + 1].current;\n      let minHeight = 1;\n      if (\n        thisObject.state.info.type === 'event'\n      ) {\n        const endDate = thisObject.state.info.endDate;\n        if (!endDate.includes('--')) {\n          // rounded to 30 minutes\n          minHeight = (endDate[0] * 60 + endDate[1]) / 60;\n        } else if (nextObject.state.info.type === 'event') {\n          // no end date\n          const startDate = nextObject.state.info.startDate;\n          if (!startDate.includes('--')) {\n            const difference = \n              util.getTime(startDate) - util.getTime(thisObject.state.info.startDate);\n            minHeight = difference / 60;\n          }\n        }\n      }\n      thisObject.setState({ minHeight: minHeight });\n    }\n    if (objects.length > 0) {\n      let minHeight = 1;\n      const lastObject = objects[objects.length - 1].current;\n      const endDate = lastObject.state.info.endDate;\n      if (lastObject.state.info.type === 'event' &&\n        !endDate.includes('--')) {\n        // rounded to 30 minutes\n        minHeight = (endDate[0] * 60 + endDate[1]) / 60;\n      }\n      lastObject.setState({ minHeight: minHeight });\n    }\n  }\n  dropTask = (ev, type) => {\n    edit.selectTask(window.draggedTask);\n    const listParent = window.selected.props.parent;\n    edit.cutTask();\n    edit.save(listParent, 'list');\n    window.preventSelect = false;\n    setTimeout(() => {\n      edit.selectTask(this);\n      if (type === 'subtask') {\n        edit.pasteTask('task');\n      } else if (type === 'task') {\n        edit.pasteTask();\n      }\n    }, 100);\n    this.setState({\n      taskDrop: false,\n      subtaskDrop: false,\n    })\n    ev.stopPropagation();\n  }\n  render() {\n    var selectThis = () => {\n      edit.selectTask(this);\n    }\n    this.changeTitle = this.changeTitle.bind(this);\n    this.listInput = React.createRef();\n    this.subtasksCurrent = this.state.subtasks.filter(x =>\n      !(x.charAt(0) === 'R' && !this.props.repeats.includes(x)) &&\n      window.data.tasks[util.stripR(x)]);\n    if (this.props.parent.props.id === 'river') {\n      for (let task of this.props.repeats) {\n        if (!this.subtasksCurrent.includes(task) &&\n          !this.subtasksCurrent.includes(util.stripR(task))) {\n          this.subtasksCurrent.push(task);\n        }\n      }\n    }\n    if (util.getFrame(this).props.id === 'river') {\n      this.sortList();\n      setTimeout(this.updateHeights, 100);\n    }\n    const drop = (ev) => {\n      edit.selectTask(window.draggedTask);\n      const listParent = window.selected.props.parent;\n      edit.cutTask();\n      edit.save(listParent, 'list');\n      window.preventSelect = false;\n      setTimeout(() => {\n        edit.selectTask(this);\n        if (ev.metaKey) {\n          edit.pasteTask('task');\n        } else {\n          edit.pasteTask();\n        }\n      }, 100);\n      ev.stopPropagation();\n    }\n    const dragOver = (ev) => {\n      ev.preventDefault();\n      ev.dataTransfer.dropEffect = 'all';\n    }\n    const dragEnter = (ev) => {\n      ev.dataTransfer.dropEffect = 'all';\n    }\n    const dragLeave = (ev) => {\n      ev.dataTransfer.dropEffect = 'all';\n    }\n    return (\n      <div className={'list ' + this.state.zoomed} onClick={selectThis}\n        onContextMenu={selectThis}\n      >\n        <div className='listInputBackground'\n          onDragEnter={() => {\n            console.log(window.draggedTask.props.id);\n            if (window.draggedTask.props.id === this.props.id) return;\n            this.setState({taskDrop: true})\n          }}\n          onDragLeave={() => this.setState({taskDrop: false})}\n          onDrop={(ev) => this.dropTask(ev, 'subtask')}\n        >\n          {this.props.parent.props.id === 'bank' ?\n            <input className='listInput' value={this.state.title}\n              onChange={this.changeTitle} ref={this.listInput}\n              onDragOver={dragOver}\n              onDragEnter={dragEnter}\n              onDragLeave={dragLeave}\n            ></input> :\n            <input readOnly className='listInput listTitle'\n              value={util.dateFormat(this.state.title)} ref={this.listInput}\n              onDragOver={dragOver}\n              onDragEnter={dragEnter}\n            >\n            </input>\n          }\n        </div>\n        <div className='listFrame'>\n          {this.props.parent.props.id === 'river' &&\n            this.props.deadlines &&\n            <ul>\n              {this.props.deadlines.map(x => {\n                try {\n\n                return <li\n                  className='deadline' key={String(x)}\n                  onClick={() => display.searchDate(window.data.tasks[util.stripR(x)].title, 'start')}>\n                  {window.data.tasks[util.stripR(x)].title}</li>;\n                } catch {\n                  return undefined;\n                }\n              })}\n            </ul>}\n          {this.props.parent.props.id === 'river' &&\n            this.props.startdates &&\n            <ul>\n              {this.props.startdates.map(x => {\n                return (<li\n                  className='startdate' key={String(x)}\n                  onClick={() => display.searchDate(window.data.tasks[util.stripR(x)].title,\n                    'start')}>\n                  {window.data.tasks[util.stripR(x)].title}</li>);\n              })}\n            </ul>}\n          <div \n            className={`dropArea ${this.state.taskDrop ? 'droppable' : ''}`}\n            onDragOver={dragOver}\n          ></div>\n          {<TaskList ref={this.taskList} subtasks={this.subtasksCurrent}\n            parent={this} />}\n        </div>\n      </div>\n    )\n  }\n}"]},"metadata":{},"sourceType":"module"}