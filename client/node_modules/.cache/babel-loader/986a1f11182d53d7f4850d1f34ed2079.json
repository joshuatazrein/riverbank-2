{"ast":null,"code":"var _jsxFileName = \"/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/client/src/components/List/List.js\";\nimport React from 'react';\nimport './List.css';\nimport * as display from '../../services/display';\nimport * as edit from '../../services/edit';\nimport * as util from '../../services/util';\nimport TaskList from '../TaskList/TaskList';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class List extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.updateHeights = () => {\n      return;\n      if (!this.taskList.current) return;\n      const objects = this.taskList.current.subtaskObjects.filter(x => x.current.isComplete() !== 'complete');\n\n      for (let i = 0; i < objects.length - 1; i++) {\n        const thisObject = objects[i].current;\n        const nextObject = objects[i + 1].current;\n        let minHeight = 1;\n\n        if (thisObject.state.info.type === 'event') {\n          const endDate = thisObject.state.info.endDate;\n\n          if (!endDate.includes('--')) {\n            // rounded to 30 minutes\n            minHeight = (endDate[0] * 60 + endDate[1]) / 60;\n          } else if (nextObject.state.info.type === 'event') {\n            // no end date\n            const startDate = nextObject.state.info.startDate;\n\n            if (!startDate.includes('--')) {\n              const difference = util.getTime(startDate) - util.getTime(thisObject.state.info.startDate);\n              minHeight = difference / 60;\n            }\n          }\n        }\n\n        thisObject.setState({\n          minHeight: minHeight\n        });\n      }\n\n      if (objects.length > 0) {\n        let minHeight = 1;\n        const lastObject = objects[objects.length - 1].current;\n        const endDate = lastObject.state.info.endDate;\n\n        if (lastObject.state.info.type === 'event' && !endDate.includes('--')) {\n          // rounded to 30 minutes\n          minHeight = (endDate[0] * 60 + endDate[1]) / 60;\n        }\n\n        lastObject.setState({\n          minHeight: minHeight\n        });\n      }\n    };\n\n    this.dropTask = (ev, type) => {\n      edit.selectTask(window.draggedTask);\n      const listParent = window.selected.props.parent;\n      edit.cutTask();\n      edit.save(listParent, 'list');\n      window.preventSelect = false;\n      setTimeout(() => {\n        edit.selectTask(this);\n\n        if (type === 'subtask') {\n          edit.pasteTask('task');\n        } else if (type === 'task') {\n          edit.pasteTask();\n        }\n      }, 100);\n      this.setState({\n        taskDrop: false,\n        subtaskDrop: false\n      });\n      ev.stopPropagation();\n    };\n\n    this.taskList = /*#__PURE__*/React.createRef();\n    this.state = {\n      // filter subtasks here\n      subtasks: props.subtasks,\n      title: props.title,\n      info: {},\n      zoomed: ''\n    };\n  }\n\n  changeTitle(ev) {\n    this.setState({\n      title: ev.target.value\n    });\n  }\n\n  sortList() {\n    // sort the given list by time\n    let ordered = true;\n    let currentTime = 0;\n\n    for (let x of this.subtasksCurrent) {\n      const task = window.data.tasks[util.stripR(x)];\n      const thisTime = util.getTime(task.info.startDate);\n\n      if (task.info.type === 'event' && thisTime < currentTime) {\n        ordered = false;\n        break;\n      }\n\n      currentTime = thisTime;\n    }\n\n    if (ordered) return; // sort the list\n\n    let sortedList = [];\n    let currentSort = ['start'];\n\n    for (let task of this.subtasksCurrent) {\n      const taskData = window.data.tasks[util.stripR(task)];\n\n      if (taskData.info.type === 'event' && !taskData.info.startDate.includes('--')) {\n        sortedList.push(currentSort);\n        currentSort = [];\n        currentSort.push(task);\n      } else {\n        currentSort.push(task);\n      }\n    }\n\n    sortedList.push(currentSort); // add last thing\n\n    sortedList = sortedList.sort((a, b) => {\n      if (a[0] === 'start' || a.length === 0) {\n        a = a.splice(0, 1);\n        return -1;\n      } else if (b[0] === 'start' || b.length === 0) {\n        b = b.splice(0, 1);\n        return 1;\n      } else {\n        return util.getTime(window.data.tasks[util.stripR(a[0])].info.startDate) - util.getTime(window.data.tasks[util.stripR(b[0])].info.startDate);\n      }\n    }).flat();\n    this.subtasksCurrent = sortedList;\n  }\n\n  render() {\n    var selectThis = () => {\n      edit.selectTask(this);\n    };\n\n    this.changeTitle = this.changeTitle.bind(this);\n    this.listInput = /*#__PURE__*/React.createRef();\n    this.subtasksCurrent = this.state.subtasks.filter(x => !(x.charAt(0) === 'R' && !this.props.repeats.includes(x)) && window.data.tasks[util.stripR(x)]);\n\n    if (this.props.parent.props.id === 'river') {\n      for (let task of this.props.repeats) {\n        if (!this.subtasksCurrent.includes(task) && !this.subtasksCurrent.includes(util.stripR(task))) {\n          this.subtasksCurrent.push(task);\n        }\n      }\n    }\n\n    if (util.getFrame(this).props.id === 'river') {\n      this.sortList();\n      setTimeout(this.updateHeights, 100);\n    }\n\n    const drop = ev => {\n      edit.selectTask(window.draggedTask);\n      const listParent = window.selected.props.parent;\n      edit.cutTask();\n      edit.save(listParent, 'list');\n      window.preventSelect = false;\n      setTimeout(() => {\n        edit.selectTask(this);\n\n        if (ev.metaKey) {\n          edit.pasteTask('task');\n        } else {\n          edit.pasteTask();\n        }\n      }, 100);\n      ev.stopPropagation();\n    };\n\n    const dragOver = ev => {\n      ev.preventDefault();\n      ev.dataTransfer.dropEffect = 'all';\n    };\n\n    const dragEnter = ev => {\n      ev.dataTransfer.dropEffect = 'all';\n    };\n\n    const dragLeave = ev => {\n      ev.dataTransfer.dropEffect = 'all';\n    };\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: 'list ' + this.state.zoomed,\n      onClick: selectThis,\n      onContextMenu: selectThis,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"listInputBackground\",\n        onDragEnter: () => {\n          console.log(window.draggedTask.props.id);\n          if (window.draggedTask.props.id === this.props.id) return;\n          this.setState({\n            taskDrop: true\n          });\n        },\n        onDragLeave: () => this.setState({\n          taskDrop: false\n        }),\n        onDrop: ev => this.dropTask(ev, 'subtask'),\n        children: this.props.parent.props.id === 'bank' ? /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"listInput\",\n          value: this.state.title,\n          onChange: this.changeTitle,\n          ref: this.listInput,\n          onDragOver: dragOver,\n          onDragEnter: dragEnter,\n          onDragLeave: dragLeave\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"input\", {\n          readOnly: true,\n          className: \"listInput listTitle\",\n          value: util.dateFormat(this.state.title),\n          ref: this.listInput,\n          onDragOver: dragOver,\n          onDragEnter: dragEnter\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"listFrame\",\n        children: [this.props.parent.props.id === 'river' && this.props.deadlines && /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: this.props.deadlines.map(x => {\n            try {\n              return /*#__PURE__*/_jsxDEV(\"li\", {\n                className: \"deadline\",\n                onClick: () => display.searchDate(window.data.tasks[util.stripR(x)].title, 'start'),\n                children: window.data.tasks[util.stripR(x)].title\n              }, String(x), false, {\n                fileName: _jsxFileName,\n                lineNumber: 213,\n                columnNumber: 24\n              }, this);\n            } catch {\n              return undefined;\n            }\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 13\n        }, this), this.props.parent.props.id === 'river' && this.props.startdates && /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: this.props.startdates.map(x => {\n            return /*#__PURE__*/_jsxDEV(\"li\", {\n              className: \"startdate\",\n              onClick: () => display.searchDate(window.data.tasks[util.stripR(x)].title, 'start'),\n              children: window.data.tasks[util.stripR(x)].title\n            }, String(x), false, {\n              fileName: _jsxFileName,\n              lineNumber: 226,\n              columnNumber: 25\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `dropArea ${this.state.taskDrop ? 'droppable' : ''}`,\n          onDragOver: dragOver\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(TaskList, {\n          ref: this.taskList,\n          subtasks: this.subtasksCurrent,\n          parent: this\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 12\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/frederic/Documents/big-projects/2021-11-01_riverbank-2/riverbank-2/client/src/components/List/List.js"],"names":["React","display","edit","util","TaskList","List","Component","constructor","props","updateHeights","taskList","current","objects","subtaskObjects","filter","x","isComplete","i","length","thisObject","nextObject","minHeight","state","info","type","endDate","includes","startDate","difference","getTime","setState","lastObject","dropTask","ev","selectTask","window","draggedTask","listParent","selected","parent","cutTask","save","preventSelect","setTimeout","pasteTask","taskDrop","subtaskDrop","stopPropagation","createRef","subtasks","title","zoomed","changeTitle","target","value","sortList","ordered","currentTime","subtasksCurrent","task","data","tasks","stripR","thisTime","sortedList","currentSort","taskData","push","sort","a","b","splice","flat","render","selectThis","bind","listInput","charAt","repeats","id","getFrame","drop","metaKey","dragOver","preventDefault","dataTransfer","dropEffect","dragEnter","dragLeave","console","log","dateFormat","deadlines","map","searchDate","String","undefined","startdates"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './List.css';\nimport * as display from '../../services/display';\nimport * as edit from '../../services/edit';\nimport * as util from '../../services/util';\nimport TaskList from '../TaskList/TaskList';\n\nexport default class List extends React.Component {\n  constructor(props) {\n    super(props);\n    this.taskList = React.createRef();\n    this.state = {\n      // filter subtasks here\n      subtasks: props.subtasks,\n      title: props.title,\n      info: {}, zoomed: ''\n    };\n  }\n  changeTitle(ev) {\n    this.setState({ title: ev.target.value });\n  }\n  sortList() {\n    // sort the given list by time\n    let ordered = true;\n    let currentTime = 0;\n    for (let x of this.subtasksCurrent) {\n      const task = window.data.tasks[util.stripR(x)];\n      const thisTime = util.getTime(task.info.startDate);\n      if (\n        task.info.type === 'event' &&\n        thisTime < currentTime\n      ) {\n        ordered = false;\n        break;\n      }\n      currentTime = thisTime;\n    }\n    if (ordered) return;\n    // sort the list\n    let sortedList = [];\n    let currentSort = ['start'];\n    for (let task of this.subtasksCurrent) {\n      const taskData = window.data.tasks[util.stripR(task)];\n      if (taskData.info.type === 'event' && \n        !taskData.info.startDate.includes('--')) {\n        sortedList.push(currentSort);\n        currentSort = [];\n        currentSort.push(task);\n      } else {\n        currentSort.push(task);\n      }\n    }\n    sortedList.push(currentSort); // add last thing\n    sortedList = sortedList.sort((a, b) => {\n      if (a[0] === 'start' || a.length === 0) {\n        a = a.splice(0, 1);\n        return -1;\n      } else if (b[0] === 'start' || b.length === 0) {\n        b = b.splice(0, 1);\n        return 1;\n      } else {\n        return util.getTime(window.data.tasks[util.stripR(a[0])].info.startDate) - \n          util.getTime(window.data.tasks[util.stripR(b[0])].info.startDate)\n      }\n    }).flat();\n    this.subtasksCurrent = sortedList;\n  }\n  updateHeights = () => {\n    return\n    if (!this.taskList.current) return;\n    const objects = this.taskList.current.subtaskObjects.filter(\n      x => x.current.isComplete() !== 'complete'\n    );\n    for (\n      let i = 0; i < objects.length - 1; i++\n    ) {\n      const thisObject = objects[i].current;\n      const nextObject = objects[i + 1].current;\n      let minHeight = 1;\n      if (\n        thisObject.state.info.type === 'event'\n      ) {\n        const endDate = thisObject.state.info.endDate;\n        if (!endDate.includes('--')) {\n          // rounded to 30 minutes\n          minHeight = (endDate[0] * 60 + endDate[1]) / 60;\n        } else if (nextObject.state.info.type === 'event') {\n          // no end date\n          const startDate = nextObject.state.info.startDate;\n          if (!startDate.includes('--')) {\n            const difference = \n              util.getTime(startDate) - util.getTime(thisObject.state.info.startDate);\n            minHeight = difference / 60;\n          }\n        }\n      }\n      thisObject.setState({ minHeight: minHeight });\n    }\n    if (objects.length > 0) {\n      let minHeight = 1;\n      const lastObject = objects[objects.length - 1].current;\n      const endDate = lastObject.state.info.endDate;\n      if (lastObject.state.info.type === 'event' &&\n        !endDate.includes('--')) {\n        // rounded to 30 minutes\n        minHeight = (endDate[0] * 60 + endDate[1]) / 60;\n      }\n      lastObject.setState({ minHeight: minHeight });\n    }\n  }\n  dropTask = (ev, type) => {\n    edit.selectTask(window.draggedTask);\n    const listParent = window.selected.props.parent;\n    edit.cutTask();\n    edit.save(listParent, 'list');\n    window.preventSelect = false;\n    setTimeout(() => {\n      edit.selectTask(this);\n      if (type === 'subtask') {\n        edit.pasteTask('task');\n      } else if (type === 'task') {\n        edit.pasteTask();\n      }\n    }, 100);\n    this.setState({\n      taskDrop: false,\n      subtaskDrop: false,\n    })\n    ev.stopPropagation();\n  }\n  render() {\n    var selectThis = () => {\n      edit.selectTask(this);\n    }\n    this.changeTitle = this.changeTitle.bind(this);\n    this.listInput = React.createRef();\n    this.subtasksCurrent = this.state.subtasks.filter(x =>\n      !(x.charAt(0) === 'R' && !this.props.repeats.includes(x)) &&\n      window.data.tasks[util.stripR(x)]);\n    if (this.props.parent.props.id === 'river') {\n      for (let task of this.props.repeats) {\n        if (!this.subtasksCurrent.includes(task) &&\n          !this.subtasksCurrent.includes(util.stripR(task))) {\n          this.subtasksCurrent.push(task);\n        }\n      }\n    }\n    if (util.getFrame(this).props.id === 'river') {\n      this.sortList();\n      setTimeout(this.updateHeights, 100);\n    }\n    const drop = (ev) => {\n      edit.selectTask(window.draggedTask);\n      const listParent = window.selected.props.parent;\n      edit.cutTask();\n      edit.save(listParent, 'list');\n      window.preventSelect = false;\n      setTimeout(() => {\n        edit.selectTask(this);\n        if (ev.metaKey) {\n          edit.pasteTask('task');\n        } else {\n          edit.pasteTask();\n        }\n      }, 100);\n      ev.stopPropagation();\n    }\n    const dragOver = (ev) => {\n      ev.preventDefault();\n      ev.dataTransfer.dropEffect = 'all';\n    }\n    const dragEnter = (ev) => {\n      ev.dataTransfer.dropEffect = 'all';\n    }\n    const dragLeave = (ev) => {\n      ev.dataTransfer.dropEffect = 'all';\n    }\n    return (\n      <div className={'list ' + this.state.zoomed} onClick={selectThis}\n        onContextMenu={selectThis}\n      >\n        <div className='listInputBackground'\n          onDragEnter={() => {\n            console.log(window.draggedTask.props.id);\n            if (window.draggedTask.props.id === this.props.id) return;\n            this.setState({taskDrop: true})\n          }}\n          onDragLeave={() => this.setState({taskDrop: false})}\n          onDrop={(ev) => this.dropTask(ev, 'subtask')}\n        >\n          {this.props.parent.props.id === 'bank' ?\n            <input className='listInput' value={this.state.title}\n              onChange={this.changeTitle} ref={this.listInput}\n              onDragOver={dragOver}\n              onDragEnter={dragEnter}\n              onDragLeave={dragLeave}\n            ></input> :\n            <input readOnly className='listInput listTitle'\n              value={util.dateFormat(this.state.title)} ref={this.listInput}\n              onDragOver={dragOver}\n              onDragEnter={dragEnter}\n            >\n            </input>\n          }\n        </div>\n        <div className='listFrame'>\n          {this.props.parent.props.id === 'river' &&\n            this.props.deadlines &&\n            <ul>\n              {this.props.deadlines.map(x => {\n                try {\n\n                return <li\n                  className='deadline' key={String(x)}\n                  onClick={() => display.searchDate(window.data.tasks[util.stripR(x)].title, 'start')}>\n                  {window.data.tasks[util.stripR(x)].title}</li>;\n                } catch {\n                  return undefined;\n                }\n              })}\n            </ul>}\n          {this.props.parent.props.id === 'river' &&\n            this.props.startdates &&\n            <ul>\n              {this.props.startdates.map(x => {\n                return (<li\n                  className='startdate' key={String(x)}\n                  onClick={() => display.searchDate(window.data.tasks[util.stripR(x)].title,\n                    'start')}>\n                  {window.data.tasks[util.stripR(x)].title}</li>);\n              })}\n            </ul>}\n          <div \n            className={`dropArea ${this.state.taskDrop ? 'droppable' : ''}`}\n            onDragOver={dragOver}\n          ></div>\n          {<TaskList ref={this.taskList} subtasks={this.subtasksCurrent}\n            parent={this} />}\n        </div>\n      </div>\n    )\n  }\n}"]},"metadata":{},"sourceType":"module"}